function renderChart(e,t,n,r){function S(e){return $.formatNumber(e,{format:"#,###",locale:"us"})}function x(i,s,o,u,f){var c=w.append("g").attr("transform","translate("+s+",0)");c.append("text").text(S(u)+" "+o+" in "+n).attr("x",p/2).attr("y",-15).attr("text-anchor","middle").attr("class","panelHeader-"+i),t!==undefined&&c.append("text").text(S(f)+" "+o+" in "+r).attr("x",p/2).attr("y",15).attr("text-anchor","middle").attr("class","panelHeader-small-"+i),c.selectAll("rect").data(e).enter().append("rect").attr("class",i).attr("x",function(e){return i==="male"?y.range()[1]-y(e[i].percentOfTotal):0}).attr("y",function(e,t){return b(t)}).attr("height",b.rangeBand()).attr("width",function(e){return y(e[i].percentOfTotal)});if(t!==undefined){var h=d3.svg.line().x(function(e){return i==="male"?y.range()[1]-y(e[i].percentOfTotal):y(e[i].percentOfTotal)}).y(function(e,n){return n==t.length?b.rangeExtent()[0]:b(n)+b.rangeBand()}).interpolate("step-before");c.append("svg:path").attr("class","outline-"+i).attr("d",h(t.concat(t[t.length-1])))}var d=y.ticks(5),v=i==="male"?function(e){return y.range()[1]-y(e)}:y,m=w.append("g").attr("transform","translate("+s+","+(a-l)+")");m.selectAll("text.tickLabel").data(d).enter().append("text").attr("class","tickLabel").attr("x",v).attr("dy",25).attr("text-anchor","middle").text(String),m.append("line").attr("class","axis").attr("x1",y.range()[0]).attr("x2",y.range()[1]).attr("y1",1).attr("y2",1),m.selectAll("line.tick").data(d).enter().append("line").attr("class","tick").attr("x1",v).attr("x2",v).attr("y1",1).attr("y2",6),m.append("text").attr("class","panelHeader").attr("x",p/2).attr("y",55).attr("text-anchor","middle").text(o+", by single year of age, as percent of the total population")}var i={top:40,right:10,bottom:20,left:10},s=940,o=800,u=s-i.left-i.right,a=o-i.top-i.bottom,f=50,l=40,c=d3.nest().key(function(e){return"all"}).rollup(function(e){return d3.sum(e,function(e){return parseInt(e.male.people)})}).entries(e)[0].values,h=d3.nest().key(function(e){return"all"}).rollup(function(e){return d3.sum(e,function(e){return parseInt(e.female.people)})}).entries(e)[0].values,p=(u-f)/2,d=d3.max(e,function(e){return d3.max([e.male.percentOfTotal,e.female.percentOfTotal])});if(t!==undefined){var v=d3.nest().key(function(e){return"all"}).rollup(function(e){return d3.sum(e,function(e){return parseInt(e.male.people)})}).entries(t)[0].values,m=d3.nest().key(function(e){return"all"}).rollup(function(e){return d3.sum(e,function(e){return parseInt(e.female.people)})}).entries(t)[0].values,g=d3.max(t,function(e){return d3.max([e.male.percentOfTotal,e.female.percentOfTotal])});d=d3.max([d,g])}var y=d3.scale.linear().domain([0,d]).range([0,p]).nice(),b=d3.scale.ordinal().domain(d3.range(0,e.length)).rangeBands([a-l,0]),w=d3.select("#chart").append("svg").attr("width",s).attr("height",o).append("g").attr("transform","translate("+i.left+","+i.top+")"),E=w.append("g").attr("transform","translate("+p+",0)");E.append("text").text("Age").attr("x",f/2).attr("y",-15).attr("text-anchor","middle").attr("class","centerHeader"),E.selectAll("text.tickLabel").data(e).enter().append("text").attr("class","tickLabel").attr("x",f/2).attr("y",function(e,t){return b(t)+b.rangeBand()/2}).attr("dy",".35em").attr("text-anchor","middle").attr("display",function(e,t){return t%5===0?"block":"none"}).text(function(e){return e.age}),x("male",0,"Males",c,v),x("female",f+p,"Females",h,m);var T=w.append("g");T.selectAll("rect").data(e).enter().append("rect").attr("class","interaction-overlay").attr("x",0).attr("y",function(e,t){return b(t)}).attr("width",u).attr("height",b.rangeBand()).attr("fill","none").attr("stroke","none").attr("pointer-events","visible").attr("title",function(e){return"Age "+e.age+" in "+n}).attr("data-content",function(e,n){return'<div style="white-space:nowrap;"><b>'+S(e.total.people)+" people, "+d3.round(e.total.percentOfTotal,2)+"% of population"+"</b>"+(t!==undefined?" (vs. "+r+" "+S(t[n].total.people)+" people, "+d3.round(t[n].total.percentOfTotal,2)+"%)":"")+"</div>"+'<div style="white-space:nowrap;">'+S(e.male.people)+" males,"+d3.round(e.male.percentOfTotal,2)+"% of population"+(t!==undefined?" (vs. "+r+" "+S(t[n].male.people)+" males, "+d3.round(t[n].male.percentOfTotal,2)+"%)":"")+"</div>"+'<div style="white-space:nowrap;">'+S(e.female.people)+" females,"+d3.round(e.female.percentOfTotal,2)+"% of population"+(t!==undefined?" (vs. "+r+" "+S(t[n].female.people)+" females, "+d3.round(t[n].female.percentOfTotal,2)+"%)":"")+"</div>"}).on("mouseover",function(e,t){d3.select(this).attr("fill","rgba(0,0,0,.15)")}).on("mouseout",function(e,t){d3.select(this).attr("fill","none")}),$(".interaction-overlay").cpopover({placement:"bottom"})}