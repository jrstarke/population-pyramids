Modernizr.svg&&Modernizr.inlinesvg?d3.json("/regions.json",function(e){var t={};e.forEach(function(e){var n=e.n.toLowerCase();e.g==="CSD"&&(n=n.substring(0,n.length-" (CSD)".length)),e.g==="CD"&&(n=n.substring(0,n.length-" (CD)".length)),t.hasOwnProperty(n)||(t[n]=[]),t[n].push(e)});var n=[],r={};for(var i in t)if(t.hasOwnProperty(i)){var s=t[i];if(s.length===1){var i=s[0].n;s[0].g==="CSD"&&(i=i.substring(0,i.length-" (CSD)".length)),s[0].g==="CD"&&(i=i.substring(0,i.length-" (CD)".length)),r[i.toLowerCase()]=s[0].i,n.push(i)}else console.log(s),s.forEach(function(e){if(e.g==="CD")r[e.n.toLowerCase()]=e.i,n.push(e.n);else if(e.g==="CSD"){var t=e.n.substring(0,e.n.length-")".length)+"-"+e.t+")";r[t.toLowerCase()]=e.i,n.push(t)}})}var o={};e.forEach(function(e){o[e.n.toLowerCase()]=e.i});var u=function(e){$(e).typeahead({source:n}),$(e).change(function(e){g()}),$(e).submit(function(e){e.preventDefault(),g()}),$(e).keydown(function(t){t.keyCode==13&&!$(e).data("typeahead").shown&&g()})},a=function(e){$("#mainErrorMessage").text("Place '"+e+"' not found."),$("#mainErrorBox").show()},f=function(e){e===undefined?$("#compareErrorBox").hide():($("#compareErrorMessage").text("Place '"+e+"' not found for comparison."),$("#compareErrorBox").show())},l={},c=function(e,t){l.hasOwnProperty(e)?t(l[e]):d3.json("/region/"+e+".json",function(n){l[e]=n,t(n)})},h=function(e,t){var n=r[e.toLowerCase()];n===undefined&&(n=o[e.toLowerCase()]);var i=t!==undefined?r[t.toLowerCase()]:undefined;i===undefined&&(i=t!==undefined?o[t.toLowerCase()]:undefined),n===undefined&&i==undefined?(a(e),f(t)):n===undefined?(a(e),$("#compareErrorBox").hide()):i===undefined?($("#mainErrorBox").hide(),f(t)):($("#mainErrorBox").hide(),$("#compareErrorBox").hide()),$("#chart").empty(),$(".popover").remove();if(n!==undefined||i!=undefined)if(n!==undefined)if(i===undefined)$("#loadingBox").show(),c(n,function(t){renderChart(t,undefined,e,undefined),$("#loadingBox").hide()});else{$("#loadingBox").show();var s=undefined,u=undefined,l=function(){s!==undefined&&u!==undefined&&(renderChart(s,u,e,t),$("#loadingBox").hide())};c(n,function(e){s=e,l()}),c(i,function(e){u=e,l()})}};u("#select_main"),u("#select_compare");var p=function(e,t){var n={data_track_addressbar:!0,data_ga_social:!0,data_ga_property:"UA-69155-30"},r=undefined;t!==undefined?r={email_vars:{CustomText:"Age profile of "+e+" compared to "+t},email_template:"pop_pyramid",description:"Age profile of "+e+" compared to "+t,templates:{twitter:"Age profile of "+e+" compared to "+t+" {{url}} (vis by @jamiestarke @lgrammel)"}}:r={email_vars:{CustomText:"Age profile of "+e},email_template:"pop_pyramid",description:"Age profile of "+e,templates:{twitter:"Age profile of "+e+" {{url}} (vis by @jamiestarke @lgrammel)"}},$("#addthis").html('<a class="addthis_button_facebook"></a><a class="addthis_button_twitter"></a><a class="addthis_button_compact"></a>'),window.addthis.toolbox("#addthis",n,r)},d=function(e,t){t!==undefined?window.document.title=e+" compared to "+t+" - Canadian Population Pyramids":window.document.title=e+" Canadian Population Pyramid"},v=function(e,t){$("#select_main").val(e),$("#select_compare").val(t)},m=function(e,t){window._gaq.push(["_trackPageview",window.location.pathname+window.location.hash]),window._gat._getTrackerByName()._trackEvent("Region View",e,"Main Region"),window._gat._getTrackerByName()._trackEvent("Region View",t,"Comparison Region")},g=function(e,t){e===undefined&&(e=$("#select_main").val()),t===undefined&&(t=$("#select_compare").val());if(e==="")return;hasher.setHash(encodeURIComponent(e)+"/"+encodeURIComponent(t))},y=undefined,b=undefined,w=function(e,t){e=decodeURIComponent(e),t=t!==undefined?decodeURIComponent(t):undefined;if(e===y&&t===b)return;y=e,b=t,d(e,t),v(e,t),p(e,t),h(e,t),m(e,t)};crossroads.addRoute("/{mainName}/{compareName}",w),crossroads.addRoute("/{mainName}",w),crossroads.bypassed.add(function(){g("Capital, BC","Canada")});var E=function(e,t){crossroads.parse(e)};hasher.initialized.add(E),hasher.changed.add(E),hasher.init()}):($("#unsupportedBrowser").show(),$("#inputBar").hide())